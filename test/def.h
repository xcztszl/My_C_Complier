#include "stdio.h"
#include "stdlib.h"
#include "string.h"
#include "stdarg.h"
#include "parser.tab.h"
#define MAXLENGTH   200
#define DX 3*sizeof(int)          /*æ´»åŠ¨è®°å½•æ§åˆ¶ä¿¡æ¯éœ€è¦çš„å•å…ƒæ•°ï¼Œè¿™ä¸ªæ ¹æ®å®é™…ç³»ç»Ÿè°ƒæ•´*/
//ä»¥ä¸‹è¯­æ³•æ ‘ç»“ç‚¹ç±»å‹ã€ä¸‰åœ°å€ç»“ç‚¹ç±»å‹ç­‰å®šä¹‰ä»…ä¾›å‚è€ƒï¼Œå®éªŒæ—¶ä¸€å®šè¦æ ¹æ®è‡ªå·±çš„ç†è§£æ¥å®šä¹‰

struct opn{
    int kind;    //æ ‡è¯†è”åˆæˆå‘˜çš„å±æ€?
    int type;    //æ ‡è¯†æ“ä½œæ•°çš„æ•°æ®ç±»å‹
    union {
        int     const_int;      //æ•´å¸¸æ•°å€¼ï¼Œç«‹å³æ•?
        float   const_float;    //æµ®ç‚¹å¸¸æ•°å€¼ï¼Œç«‹å³æ•?
        char    const_char;     //å­—ç¬¦å¸¸æ•°å€¼ï¼Œç«‹å³æ•?
        char    id[33];         //å˜é‡æˆ–ä¸´æ—¶å˜é‡çš„åˆ«åæˆ–æ ‡å·å­—ç¬¦ä¸²
        };
    int level;                  //å˜é‡çš„å±‚å·ï¼Œ0è¡¨ç¤ºæ˜¯å…¨å±€å˜é‡ï¼Œæ•°æ®ä¿å­˜åœ¨é™æ€æ•°æ®åŒº
    int offset;                 //åç§»é‡ï¼Œç›®æ ‡ä»£ç ç”Ÿæˆæ—¶ç”¨
    };

struct codenode {   //ä¸‰åœ°å€TACä»£ç ç»“ç‚¹,é‡‡ç”¨å•é“¾è¡¨å­˜æ”¾ä¸­é—´è¯­è¨€ä»£ç 
        int  op;
        struct opn opn1,opn2,result;
        struct codenode  *next,*prior;
    };

struct ASTNode {
        //ä»¥ä¸‹å¯¹ç»“ç‚¹å±æ€§å®šä¹‰æ²¡æœ‰è€ƒè™‘å­˜å‚¨æ•ˆç‡ï¼Œåªæ˜¯ç®€å•åœ°åˆ—å‡ºè¦ç”¨åˆ°çš„ä¸€äº›å±æ€?
	int kind;
	union {
		  char type_id[33];             //ç”±æ ‡è¯†ç¬¦ç”Ÿæˆçš„å¶ç»“ç‚¹
		  int type_int;                 //ç”±æ•´å¸¸æ•°ç”Ÿæˆçš„å¶ç»“ç‚¹
		  float type_float;               //ç”±æµ®ç‚¹å¸¸æ•°ç”Ÿæˆçš„å¶ç»“ç‚?
          char type_char;
	      };
    struct ASTNode *ptr[4];         //ç”±kindç¡®å®šæœ‰å¤šå°‘æ£µå­æ ‘
    int place;                     //å­˜æ”¾ï¼ˆä¸´æ—¶ï¼‰å˜é‡åœ¨ç¬¦å·è¡¨çš„ä½ç½®åºå?
    char Etrue[15],Efalse[15];       //å¯¹å¸ƒå°”è¡¨è¾¾å¼çš„ç¿»è¯‘æ—¶ï¼ŒçœŸå‡è½¬ç§»ç›®æ ‡çš„æ ‡å·
    char Snext[15];               //ç»“ç‚¹å¯¹åº”è¯­å¥Sæ‰§è¡Œåçš„ä¸‹ä¸€æ¡è¯­å¥ä½ç½®æ ‡å?
    struct codenode *code;          //è¯¥ç»“ç‚¹ä¸­é—´ä»£ç é“¾è¡¨å¤´æŒ‡é’ˆ
    int type;                      //ç”¨ä»¥æ ‡è¯†è¡¨è¾¾å¼ç»“ç‚¹çš„ç±»å‹
    int pos;                       //è¯­æ³•å•ä½æ‰€åœ¨ä½ç½®è¡Œå?
    int offset;                     //åç§»é‡?
    int width;                     //å æ•°æ®å­—èŠ‚æ•°
    int num;                      //è®¡æ•°å™¨ï¼Œå¯ä»¥ç”¨æ¥ç»Ÿè®¡å½¢å‚ä¸ªæ•°
    int func_type;
    };

struct symbol {       //è¿™é‡Œåªåˆ—å‡ºäº†ä¸€ä¸ªç¬¦å·è¡¨é¡¹çš„éƒ¨åˆ†å±æ€§ï¼Œæ²¡è€ƒè™‘å±æ€§é—´çš„äº’æ–?
    char name[33];   //å˜é‡æˆ–å‡½æ•°å
    int level;        //å±‚å·
    int type;         //å˜é‡ç±»å‹æˆ–å‡½æ•°è¿”å›å€¼ç±»å?
    int  paramnum;  //å¯¹å‡½æ•°é€‚ç”¨ï¼Œè®°å½•å½¢å¼å‚æ•°ä¸ªæ•?
    char alias[10];   //åˆ«åï¼Œä¸ºè§£å†³åµŒå¥—å±‚æ¬¡ä½¿ç”¨
    char flag;       //ç¬¦å·æ ‡è®°ï¼Œå‡½æ•°ï¼š'F'  å˜é‡ï¼?'V'   å‚æ•°ï¼?'P'  ä¸´æ—¶å˜é‡ï¼?'T'
    int array[10];  //ç»´åº¦
    int offset;      //å¤–éƒ¨å˜é‡å’Œå±€éƒ¨å˜é‡åœ¨å…¶é™æ€æ•°æ®åŒºæˆ–æ´»åŠ¨è®°å½•ä¸­çš„åç§»é‡ï¼?
//æˆ–è®°å½•å‡½æ•°æ´»åŠ¨è®°å½•å¤§å°ï¼Œç›®æ ‡ä»£ç ç”Ÿæˆæ—¶ä½¿ç”?
    //å‡½æ•°å…¥å£ç­‰å®éªŒå¯èƒ½ä¼šç”¨åˆ°çš„å±æ€?...
    };
//ç¬¦å·è¡?
struct symboltable{
    struct symbol symbols[MAXLENGTH];
    int index;
    } symbolTable;

struct symbol_scope_begin {
    //å½“å‰ä½œç”¨åŸŸçš„ç¬¦å·åœ¨ç¬¦å·è¡¨çš„èµ·å§‹ä½ç½®åºå?,è¿™æ˜¯ä¸€ä¸ªæ ˆç»“æ„,å½“ä½¿ç”¨é¡ºåºè¡¨ä½œä¸ºç¬¦å·è¡¨æ—¶ï¼Œè¿›å…¥ã€é€€å‡ºä¸€ä¸ªä½œç”¨åŸŸæ—¶éœ€è¦å¯¹å…¶æ“ä½œï¼Œä»¥å®Œæˆç¬¦å·è¡¨çš„ç®¡ç†ã€‚å¯¹å…¶å®ƒå½¢å¼çš„ç¬¦å·è¡¨ï¼Œä¸ä¸€å®šéœ€è¦æ­¤æ•°æ®ç»“æ„
    int TX[30];
    int top;
    } symbol_scope_TX;


struct ASTNode * mknode(int num,int kind,int pos,...);
void semantic_Analysis0(struct ASTNode *T);
void semantic_Analysis(struct ASTNode *T);
void boolExp(struct ASTNode *T);
void Exp(struct ASTNode *T);
void objectCode(struct codenode *head);


